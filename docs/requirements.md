# 재입고 알림 시스템 요구사항 명세

## 1. 개요

상품이 재입고되었을 때, 재입고 알림을 설정한 유저들에게 재입고 알림을 보내주는 시스템을 만들자.

<br>
<br>

## 2. 비지니스 요구 사항

- 재입고 알림을 전송하기 전, 재입고 회차를 1회 증가시킨다. ✅

  &rarr; `product`에서 재입고 회차를 관리 ✅


- 상품이 재입고 되었을 때, 알림을 설정한 순서대로 유저들에게 알림을 전송해야 함. ✅

  &rarr; 알림을 신청할 때, 자동으로 createdAt이 들어갈 것이다. 따라서 오래된 순으로 사용자를 가져오자. ✅


- 회차별로 재입고 알림을 받은 유저 목록은 저장되어야 한다.

  &rarr; **버전별로 어떻게 관리하지?** 단순히 DB에 넣으면 해결되나? 고민 필요..


- 재입고 알림을 보내던 중, 재고가 모두 없어진다면 알림 보내는 것을 중단해야 한다.

  &rarr; 로컬 캐시를 통해 제품과 수량을 관리 (적절한 동기화 전략 필요) ✅


- 재입고 알림 전송의 상태를 DB 에 저장해야 한다.
    - IN_PROGRESS (발송 중)
    - CANCELED_BY_SOLD_OUT (품절에 의한 발송 중단)
    - CANCELED_BY_ERROR (예외에 의한 발송 중단)
    - COMPLETED (완료)

  &rarr; Enum타입으로 관리하면 될듯 한데.. 발송중이라는 상태를 DB에 저장한다? 애매하다.

<br>
<br>

## 3. 기술적 요구사항

- 알림 메시지는 1초에 최대 500개의 요청을 보낼 수 있다. ✅

  &rarr; 큐를 활용해서 직접 구현했다. 단, Jmeter를 통한 스트레스 테스트 필요 ✅


- Mysql 조회 시 인덱스를 잘 탈 수 설계해야 한다.


- 알림을 보내는 동작은, 서드파티 연동을 하진 않고, ProductNotificationHistory 테이블에 데이터를 저장하는 것으로 대체

  &rarr; "알림"이라는 키워드에 너무 현혹되지 말자. 별도의 프로토콜을 통해 클라이언트에 알림을 보내는 상황은 고려하지 말라는 의미이다.


- 만약 예외로 인해 알림 메시지 발송이 실패한 경우, 마지막으로 전송에 성공한 유저부터 다시 알림 메시지를 보낼 수 있어야 한다.

  &rarr; 순서정보와 더불어, 어디까지 알림이 전송됐는지도 판단해야한다. **결국 queue와 같은 자료구조를 고려**해야될 것 같다.


- 비동기처리는 고려하지 않는다.

  &rarr; 무슨 의미일까? 여러 상품에 대해 동시에 알림을 보내는 상황을 고려하지 말라는 의미일까?

<br>
<br>

# 4. 기타 요구사항

- 상품이 없다면, 예외를 던진다. ✅


- 상품의 알림 신청자가 없다면, 예외를 던진다. ✅


- 재고가 없다면, 예외를 던진다. ✅

